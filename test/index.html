<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>If you're not OBS, Go Away</title>
  <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>
  <style>
  
    .image {
        width: 1920px;
        height: 1080px;
        display: inline-block;
        background-color: #ccc;
        margin: 0;
        position: absolute;
        top: 50%;
        left: 50%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        opacity: 0.0;
    }
  </style>
</head>

<body>

  <label for="data" id="dataL"> data:</label>
  <input type="file" id="data" name="data" onchange="previewFile()">

  <label for="data" id="clientL"> clientId:</label>
  <input type="file" id="clientID" name="clientID" onchange="previewFile2()">

  <img id="bonnie" src="./src/fnaf2_bonnie.gif" class="image" />
  <img id="chika" src="./src/fnaf2_chika.gif" class="image" />
  <img id="foxy" src="./src/fnaf2_foxy.gif" class="image" />
  <img id="freddy" src="./src/fnaf2_freddy.gif" class="image" />
  <img id="mangled" src="./src/fnaf2_mangled.gif" class="image" />
  <img id="puppet" src="./src/fnaf2_puppet.gif" class="image" />
  <img id="toy_chika" src="./src/fnaf2_toy_chika.gif" class="image" />
  <img id="toy_freddy" src="./src/fnaf2_toy_freddy.gif" class="image" />
  <img id="toy_bonnie" src="./src/fnaf2_toy_bonnie.gif" class="image" />
  <img id="golden_freddy" src="./src/fnaf2_golden_freddy.gif" class="image" />

  <img id="baby" src="./src/fnafs_baby.gif" class="image" />
  <img id="ballerina" src="./src/fnafs_ballerina.gif" class="image" />
  <img id="bonnies" src="./src/fnafs_bonnie.gif" class="image" />
  <img id="clown" src="./src/fnafs_clown.gif" class="image" />
  <img id="clown2" src="./src/fnafs_clown2.gif" class="image" />
  <img id="exo" src="./src/fnafs_exo.gif" class="image" />
  <img id="exo_shadow" src="./src/fnafs_exo_shadow.gif" class="image" />
  <img id="foxys" src="./src/fnafs_foxy.gif" class="image" />
  <img id="freddys" src="./src/fnafs_freddy.gif" class="image" />
  <img id="marianette" src="./src/fnafs_marianette.gif" class="image" />




  <audio id="bonnieSounds" src="./src/fnaf2_bonnie.mp3" type="audio/mpeg">
  <audio id="chikaSounds" src="./src/fnaf2_chika.mp3" type="audio/mpeg">
  <audio id="foxySounds" src="./src/fnaf2_foxy.mp3" type="audio/mpeg">
  <audio id="freddySounds" src="./src/fnaf2_freddy.mp3" type="audio/mpeg">
  <audio id="mangledSounds" src="./src/fnaf2_mangled.mp3" type="audio/mpeg">
  <audio id="puppetSounds" src="./src/fnaf2_puppet.mp3" type="audio/mpeg">
  <audio id="tchikaSounds" src="./src/fnaf2_toy_chika.mp3" type="audio/mpeg">
  <audio id="tfreddySounds" src="./src/fnaf2_toy_freddy.mp3" type="audio/mpeg">
  <audio id="tbonnieSounds" src="./src/fnaf2_toy_bonnie.mp3" type="audio/mpeg">
  <audio id="gfreddySounds" src="./src/fnaf2_golden_freddy.mp3" type="audio/mpeg">


  <audio id="babySounds" src="./src/fnafs_baby.mp3" type="audio/mpeg" />
  <audio id="ballerinaSounds" src="./src/fnafs_ballerina.mp3" type="audio/mpeg" />
  <audio id="bonniesSounds" src="./src/fnafs_bonnie.mp3" type="audio/mpeg" />
  <audio id="clownSounds" src="./src/fnafs_clown.mp3" type="audio/mpeg" />
  <audio id="clown2Sounds" src="./src/fnafs_clown2.mp3" type="audio/mpeg" />
  <audio id="exoSounds" src="./src/fnafs_exo.mp3" type="audio/mpeg" />
  <audio id="exosSounds" src="./src/fnafs_exo_shadow.mp3" type="audio/mpeg" />
  <audio id="foxysSounds" src="./src/fnafs_foxy.mp3" type="audio/mpeg" />
  <audio id="freddysSounds" src="./src/fnafs_freddy.mp3" type="audio/mpeg" />
  <audio id="marianetteSounds" src="./src/fnafs_marianette.mp3" type="audio/mpeg" />

  

  <script>


    // Variables that we are adjusting through cookies
    var key = "";
    var client = "";

    async function previewFile() {
        const content = document.querySelector('.content');
        const [file] = document.querySelector('input[type=file]').files;
        const reader = new FileReader();

        reader.addEventListener("load", () => {
            document.cookie = "key=" + reader.result + "; expires=Thu, 01 Jan 2080 00:00:00 UTC";
            key = reader.result;
            document.getElementById("data").remove();
            document.getElementById("dataL").remove();

            if (document.cookie != null) {
                var allCookies = document.cookie.split('; ');
   
                for(i = 0; i < allCookies.length; i++) {
   
                    if (allCookies[i].includes("key")) {
                       console.log("key written");
                       break;
                    }
                }
            }
        }, false);

        if (file) {
            reader.readAsText(file);
        }
    }

    async function previewFile2() {
        const content = document.querySelector('.content');
        const [file] = document.querySelector('input[name=clientID]').files;
        const reader = new FileReader();

        reader.addEventListener("load", () => {
            document.cookie = "client=" + reader.result + "; expires=Thu, 01 Jan 2080 00:00:00 UTC";
            client = reader.result;
            document.getElementById("clientID").remove();
            document.getElementById("clientL").remove();

            if (document.cookie != null) {
                var allCookies = document.cookie.split('; ');
   
                for(i = 0; i < allCookies.length; i++) {
   
                    if (allCookies[i].includes("client")) {
                       console.log("key written");
                       break;
                    }
                }
            }
        }, false);

        if (file) {
            reader.readAsText(file);
        }
    }


    // Determines the max number for the random generation
    var numOfJumpscares = 19;

    // Variables to pause and play audio
    var bonnie = document.getElementById("bonnieSounds");
    var chika = document.getElementById("chikaSounds");
    var foxy = document.getElementById("foxySounds");
    var freddy = document.getElementById("freddySounds");
    var goldenFreddy = document.getElementById("gfreddySounds");
    var mangled = document.getElementById("mangledSounds");
    var puppet = document.getElementById("puppetSounds");
    var toyBonnie = document.getElementById("tbonnieSounds");
    var toyChika = document.getElementById("tchikaSounds");
    var toyFreddy = document.getElementById("tfreddySounds");

    var baby = document.getElementById("babySounds");
    var ballerina = document.getElementById("ballerinaSounds");
    var bonnies = document.getElementById("bonniesSounds");
    var clown = document.getElementById("clownSounds");
    var clown2 = document.getElementById("clown2Sounds");
    var exo = document.getElementById("exoSounds");
    var exoShadow = document.getElementById("exosSounds");
    var foxys = document.getElementById("foxysSounds");
    var freddys = document.getElementById("freddysSounds");
    var marianette = document.getElementById("marianetteSounds");


    // Read the cookie and put the value into the variables and update the page
    var allCookies = document.cookie.split('; ');
    for (i = 0; i < document.cookie.split('; ').length; i++) {
        if (allCookies[i].includes("token")) {
            key = allCookies[i].substring(allCookies[i].indexOf("=")+1);
        } else if (allCookies[i].includes("refresh")) {
            refresh = allCookies[i].substring(allCookies[i].indexOf("=")+1);
	} else if (allCookies[i].includes("client")) {
            client = allCookies[i].substring(document.cookie.split('; ')[i].indexOf("=")+1);
        }
    }
    if (key != "") {
       document.getElementById("data").remove();
       document.getElementById("dataL").remove();
    }
    if (client != "") {
       document.getElementById("clientID").remove();
       document.getElementById("clientL").remove();
    }

    // Connect to the channel to read channel point redemptions
    ComfyJS.Init( "tjwombo", key);

    // JUST HERE FOR TESTING
    var random = 0;

    ComfyJS.onReward = ( user, reward, cost, message, extra ) => {
        // Play a random fnaf jumpscare
        if (reward == "Jumpscare") {

            // Get a random time between 0 delay and 45 seconds
            var wait = Math.floor(Math.random()*45000);

            // Wait for that amount of time
            setTimeout(function(){
                
                // Get a random jumpscare
                //var random = Math.floor(Math.random()* numOfJumpscares);


                // Testing through each one
                random++;
                if (random == 19) {
                    random = 0;
                }

                // Play a different video for a different time based off of the number we got
                switch(random) {

                    case 0: 
                        document.querySelector("#chika").style.opacity = 1;
                        setTimeout(function(){
                            document.querySelector("#chika").style.opacity = 0;
                        }, 340);
                        break;
                    case 1:
                        document.querySelector("#foxy").style.opacity = 1;
                        foxy.play();
                        setTimeout(function(){
                            document.querySelector("#foxy").style.opacity = 0;
                            foxy.pause();
                        }, 380);
                        break;
                    case 2:
                        document.querySelector("#freddy").style.opacity = 1;
                        freddy.play();
                        setTimeout(function(){
                            document.querySelector("#freddy").style.opacity = 0;
                            freddy.pause();
                        }, 370);
                        break;
                    case 3:
                        document.querySelector("#mangled").style.opacity = 1;
                        mangled.play();
                        setTimeout(function(){
                          document.querySelector("#mangled").style.opacity = 0;
                          mangled.pause();
                        }, 370);
                        break;
                    case 4:
                        document.querySelector("#toy_chika").style.opacity = 1;
                        toyChika.play();
                        setTimeout(function(){
                            document.querySelector("#toy_chika").style.opacity = 0;
                            toyChika.pause();
                        }, 370);
                        break;
                    case 5:
                        document.querySelector("#toy_freddy").style.opacity = 1;
                        toyFreddy.play();
                        setTimeout(function(){
                            document.querySelector("#toy_freddy").style.opacity = 0;
                            toyFreddy.pause();
                        }, 340);
                        break;
                    case 6:
                        document.querySelector("#toy_bonnie").style.opacity = 1;
                        toyBonnie.play();
                        setTimeout(function(){
                            document.querySelector("#toy_bonnie").style.opacity = 0;
                            toyBonnie.pause();
                        }, 380);
                    case 7:
                        document.querySelector("#bonnie").style.opacity = 1;
                        bonnie.play();
                        setTimeout(function(){
                           document.querySelector("#bonnie").style.opacity = 0;
                           bonnie.pause();
                        }, 430);
                        break;
                    case 8:
                        document.querySelector("#puppet").style.opacity = 1;
                        puppet.play();
                        setTimeout(function(){
                            document.querySelector("#puppet").style.opacity = 0;
                            puppet.pause();
                        }, 380);
                        break;
                    case 9:
                        document.querySelector("#baby").style.opacity = 1;
                        baby.play();
                        setTimeout(function(){
                            document.querySelector("#baby").style.opacity = 0;
                            baby.pause();
                        }, 2000 + 700/6.0);
                        break;
                    case 10:
                        document.querySelector("#ballerina").style.opacity = 1;
                        ballerina.play();
                        setTimeout(function(){
                           document.querySelector("#ballerina").style.opacity = 0;
                           ballerina.pause();
                        }, 2000 + 700/6.0);
                        break;
                    case 11:
                        document.querySelector("#bonnies").style.opacity = 1;
                        bonnies.play();
                        setTimeout(function(){
                            document.querySelector("#bonnies").style.opacity = 0;
                            bonnies.pause();
                        }, 1000 + 3700/6.0);
                        break;
                    case 12:
                        document.querySelector("#clown").style.opacity = 1;
                        clown.play();
                        setTimeout(function(){
                            document.querySelector("#clown").style.opacity = 0;
                            clown.pause();
                        }, 2000 + 800/6.0);
                        break;
                    case 13:
                        document.querySelector("#clown2").style.opacity = 1;
                        clown2.play();
                        setTimeout(function(){
                           document.querySelector("#clown2").style.opacity = 0;
                           clown2.pause();
                        }, 1000 + 2600/6.0);
                        break;
                    case 14:
                        document.querySelector("#exo").style.opacity = 1;
                        exo.play();
                        setTimeout(function(){
                            document.querySelector("#exo").style.opacity = 0;
                            exo.pause();
                        }, 1000 + 4000/6.0);
                        break;
                    case 15:
                        document.querySelector("#exo_shadow").style.opacity = 1;
                        exoShadow.play();
                        setTimeout(function(){
                            document.querySelector("#exo_shadow").style.opacity = 0;
                            exoShadow.pause();
                        }, 1000 + 3400/6.0);
                        break;
                    case 16:
                        document.querySelector("#foxys").style.opacity = 1;
                        foxys.play();
                        setTimeout(function(){
                            document.querySelector("#foxys").style.opacity = 0;
                            foxys.pause();
                        }, 1000 + 2000/6.0);
                        break;
                    case 17:
                        document.querySelector("#freddys").style.opacity = 1;
                        freddys.play();
                        setTimeout(function(){
                            document.querySelector("#freddys").style.opacity = 0;
                            freddys.pause();
                        }, 1000 + 1900/6.0);
                        break;
                    case 18:
                        document.querySelector("#marianette").style.opacity = 1;
                        marianette.play();
                        setTimeout(function(){
                            document.querySelector("#marianette").style.opacity = 0;
                            marianette.pause();
                        }, 1000 + 5500/6.0);
                        break;
                    default:
                        document.querySelector("#golden_freddy").style.opacity = 1;
                        goldenFreddy.play();
                        setTimeout(function(){
                           document.querySelector("#golden_freddy").style.opacity = 0;
                           goldenFreddy.pause();
                        }, 1420);
                        break;
                }

            }, wait);
            
        }
    }

  </script>
</body>
</html>

